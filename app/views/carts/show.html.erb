<h1>Tu carrito</h1>
<p><%= pluralize(@cart.cart_items.count, 'producto') %> en total</p>

<div class="row">
  <div class="col-md-8">
    <% @cart.cart_items.each do |item| %>
      <div class="card mb-3 shadow-sm" style="width: 100%;">
        <div class="row g-0">
          <div class="col-md-4">
            <img src="<%= item.product.image_url %>" class="img-fluid rounded-start" alt="<%= item.product.model %>">
          </div>
          <div class="col-md-8">
            <div class="card-body">
              <h5 class="card-title"><%= item.product.model %></h5>
              <p class="card-text"><small class="text-muted"><%= item.product.description %></small></p>
              <p class="card-text">Marca: <%= item.product.brand %></p>
              <p class="card-text">Talla: <%= item.product.size %></p>
              <p class="card-text">AÃ±o: <%= item.product.release_date.year %></p>
              <p class="card-text"><strong><%= number_to_currency(item.product.price) %></strong></p>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <% if item.quantity && item.quantity > 1 %>
                    <%= button_to '-', update_item_cart_path(item, quantity: item.quantity - 1), method: :patch, class: 'btn btn-outline-secondary btn-sm' %>
                  <% else %>
                    <%= button_to '-', update_item_cart_path(item, quantity: 1), method: :patch, class: 'btn btn-outline-secondary btn-sm', disabled: true %>
                  <% end %>
                  <span class="mx-2"><%= item.quantity %></span>
                  <%= button_to '+', update_item_cart_path(item, quantity: item.quantity + 1), method: :patch, class: 'btn btn-outline-secondary btn-sm', disabled: (item.quantity >= item.product.quantity_available) %>
                </div>
                <%= button_to 'Eliminar', remove_from_cart_path(item.product), method: :post, class: 'btn btn-danger btn-sm' %>
                <%= link_to 'Mover a favoritos', '#', class: 'btn btn-outline-secondary btn-sm' %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Resumen del pedido</h5>
        <p class="card-text">Productos (<%= @cart.cart_items.count %>): <%= number_to_currency(@cart.cart_items.sum { |item| item.product.price * item.quantity }) %></p>
        <hr>
        <h5 class="card-title">Subtotal incl. IVA</h5>
        <p class="card-text"><strong><%= number_to_currency(@cart.cart_items.sum { |item| item.product.price * item.quantity }) %></strong></p>
        <%= link_to 'Ir a pagar', checkout_purchases_path(cart_id: @cart.id), class: 'btn btn-primary btn-lg w-100 mt-3' %>
      </div>
    </div>
  </div>
</div>
